!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.websql=r():e.websql=r()}(global,(()=>(()=>{"use strict";var __webpack_modules__={946:module=>{function doEval(self,__pseudoworker_script){(function(){eval(__pseudoworker_script)}).call(global)}function PseudoWorker(e){var r,o,t=[],s=[],n=[],a=[],i=[],d=!1,c=this;function u(e,r){for(var o=-1;++o<e.length;)e[o]&&r(e[o])}function p(e){var r=function(e){return function(r){r({type:"error",error:e,message:e.message})}}(e);"function"==typeof c.onerror&&r(c.onerror),o&&"function"==typeof o.onerror&&r(o.onerror),u(s,r),u(a,r)}function l(e,r){function t(o){try{o({data:e,ports:r})}catch(e){p(e)}}o&&"function"==typeof o.onmessage&&t(o.onmessage),u(n,t)}function f(){d=!0}function w(e){function r(r){r({data:e})}d||("function"==typeof c.onmessage&&r(c.onmessage),u(t,r))}function g(e,r){"message"===e?n.push(r):"error"===e&&a.push(r)}var h=new XMLHttpRequest;return h.open("GET",e),h.onreadystatechange=function(){if(4===h.readyState)if(h.status>=200&&h.status<400){r=h.responseText,doEval(o={postMessage:w,addEventListener:g,close:f},r);var t=i;i=[];for(var s=0;s<t.length;s++)l(t[s].msg,t[s].transfer)}else p(new Error("cannot find script "+e))},h.send(),c.postMessage=function(e,o){if(void 0===e)throw new Error("postMessage() requires an argument");d||(r?l(e,o):i.push({msg:e,transfer:o||void 0}))},c.addEventListener=function(e,r){"message"===e?t.push(r):"error"===e&&s.push(r)},c.removeEventListener=function(e,r){var o;if("message"===e)o=t;else{if("error"!==e)return;o=s}for(var n=-1;++n<o.length;)if(o[n]===r){delete o[n];break}},c.terminate=f,c}module.exports=PseudoWorker},832:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.isIEOrLegacyEdge=void 0,r.isIEOrLegacyEdge=function(){const e=window.navigator.userAgent;return e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0}},526:function(e,r,o){var t=this&&this.__awaiter||function(e,r,o,t){return new(o||(o=Promise))((function(s,n){function a(e){try{d(t.next(e))}catch(e){n(e)}}function i(e){try{d(t.throw(e))}catch(e){n(e)}}function d(e){var r;e.done?s(e.value):(r=e.value,r instanceof o?r:new o((function(e){e(r)}))).then(a,i)}d((t=t.apply(e,r||[])).next())}))};Object.defineProperty(r,"__esModule",{value:!0}),r.Database=void 0;const s=o(832);class n{constructor(e,r={allowMainWebWorker:!1,allowWebWorkerFallback:!1}){if(this.workerUrl=e,this.options=r,this.databaseInstanceCreated=!1,this.postMessageToWorker=(e,r=[],o={})=>new Promise(((t,s)=>{const a=new n.MessageChannel;a.port1.onmessage=r=>{a.port1.close();const o=r.data.error;if(o)return s(n.translateError(o));const i=this.remapper(e,r.data.output);t(i)};const i=Object.assign({args:r.slice(),functionName:e},o),d=[a.port2];n.isNodejs?this.worker.postMessage(Object.assign(Object.assign({},i),{transfer:d}),d):n.isSharedWorkerSupported?this.worker.port.postMessage(i,d):this.worker.postMessage(i,d)})),n.isNodejs){console.log("websql: Using Node.JS Worker");const{MessageChannel:r,Worker:o}=require("worker_threads");this.worker=new o(e),n.MessageChannel=r}else if(n.isSharedWorkerSupported)console.log("websql: Using Shared Worker"),this.worker=new SharedWorker(e),this.worker.port.start();else if(!n.isSharedWorkerSupported&&n.isWorkerSupported&&!n.isIEOrLegacyEdge&&r.allowWebWorkerFallback)console.warn("websql: Using Web Worker. Experience will be degraded."),this.worker=new Worker(e);else{if(n.isSharedWorkerSupported||n.isWorkerSupported&&!n.isIEOrLegacyEdge||!r.allowMainWebWorker)throw new Error("Shared Worker are not available in your browser and Web Worker / Web Worker in Main Thread fallback is disabled. Aborting.");{console.warn("websql: Using Pseudo Web Worker. Experience will be degraded heavily."),console.log("Database.isWorkerSupported ",n.isWorkerSupported),console.log("Database.isIEOrLegacyEdge ",n.isIEOrLegacyEdge);const r=o(946);this.worker=new r(e)}}return n.isNodejs||(n.MessageChannel=window.MessageChannel,window.addEventListener("unload",(()=>t(this,void 0,void 0,(function*(){this.databaseInstanceCreated&&(n.isSharedWorkerSupported?yield this.postMessageToWorker("saveChanges"):yield this.postMessageToWorker("close"))}))))),this.createNewProxy(this,((e,...r)=>t(this,void 0,void 0,(function*(){return"_getWorkerInstance"===e?this.worker:(this.databaseInstanceCreated||(yield this.createDatabaseInstance()),yield this.postMessageToWorker(e,r))}))))}createNewProxy(e,r){return new Proxy(e,{deleteProperty:()=>{throw new Error("Forbidden operation, object is frozen")},get:(e,o)=>"then"===o?null:(...e)=>t(this,void 0,void 0,(function*(){return r(o.toString(),...e)})),has:()=>{throw new Error("Forbidden operation, object is frozen")},set:()=>{throw new Error("Forbidden operation, object is frozen")}})}createDatabaseInstance(){return t(this,void 0,void 0,(function*(){yield this.postMessageToWorker("constructor"),this.databaseInstanceCreated=!0}))}remapper(e,r){if("prepare"===e){const e=r;return this.createNewProxy({},((r,...o)=>t(this,void 0,void 0,(function*(){return yield this.postMessageToWorker(`statements.${r.toString()}`,o,{statementId:e})}))))}return r}static translateError(e){const r=new Error(e.message);return r.stack=e.stack,r.name=e.name,r}}r.Database=n,n.mountName="/sqleet",n.isNodejs="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,n.isSharedWorkerSupported=!n.isNodejs&&"undefined"!=typeof window&&"undefined"!=typeof SharedWorker,n.isWorkerSupported=!n.isNodejs&&"undefined"!=typeof window&&void 0!==window.Worker,n.isIEOrLegacyEdge="undefined"!=typeof window&&(0,s.isIEOrLegacyEdge)()}},__webpack_module_cache__={};function __webpack_require__(e){var r=__webpack_module_cache__[e];if(void 0!==r)return r.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(o.exports,o,o.exports,__webpack_require__),o.exports}var __webpack_exports__=__webpack_require__(526);return __webpack_exports__})()));